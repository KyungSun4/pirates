<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        canvas {
            display: block;
            position: absolute;
            margin: auto;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #999;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 20;
            margin: auto;
            width: 20%;
        }

        #nameIn {
            width: 100%;
            border-color: black;
            border-radius: 10;
        }
    </style>
</head>

<body>
    <div class="container">
        <input type="text" id="nameIn" placeholder="Enter Name">
    </div>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script>
        "use strict";function drawRotatedImage(a,b,c,d,e,f,g){ctx.save(),ctx.translate(a,b),ctx.rotate(e),ctx.drawImage(img,f,g,2*c,2*d,-c*scale/2,-d*scale/2,c*scale,d*scale),ctx.restore()}function mouseUp(){mouseIsDown=0,mouseXY()}function mouseDown(){mouseIsDown=1,mouseXY()}function touchDown(){mouseIsDown=1,touchXY(),tttouch=1}function touchUp(a){a||(a=event),len=a.targetTouches.length,tttouch=0,mouseIsDown=0}function mouseXY(a){a||(a=event),canX[0]=a.pageX-canvas.offsetLeft,canY[0]=a.pageY-canvas.offsetTop,len=1}function touchXY(a){a||(a=event),a.preventDefault(),len=a.targetTouches.length;for(var b=0;b<len;b++)canX[b]=a.targetTouches[b].pageX-canvas.offsetLeft,canY[b]=a.targetTouches[b].pageY-canvas.offsetTop}function init(){canvas=document.createElement("canvas"),width=window.innerWidth,height=window.innerHeight,canvas.width=width,canvas.height=height,canvas.getContext&&canvas.getContext("2d")||alert("Your browser doesn't support HTML5, please update to latest version"),document.body.appendChild(canvas),ctx=canvas.getContext("2d"),keystate={},document.addEventListener("keydown",function(a){keystate[a.keyCode]=!0}),document.addEventListener("keyup",function(a){delete keystate[a.keyCode]}),canvas.addEventListener("mousedown",mouseDown,!1),canvas.addEventListener("mousemove",mouseXY,!1),document.addEventListener("touchstart",touchDown,!1),canvas.addEventListener("touchend",touchUp,!1),canvas.addEventListener("touchmove",touchXY,!1),document.addEventListener("touchcancel",touchUp,!1),document.addEventListener("mouseup",mouseUp,!1),null!==localStorage.getItem("fleetsname")&&(name=localStorage.getItem("fleetsname"),console.log("welcome "+name),document.getElementById("nameIn").value=name);var a=function(){console.log(document.getElementById("nameIn").value),start=!0,document.getElementById("nameIn").style.visibility="hidden",name=document.getElementById("nameIn").value,localStorage.setItem("fleetsname",name),socket.emit("start",name)},b=function(){a(),touchscreen=!0},c=function(){a(),touchscreen=!1},d=function(){socket.emit("button",{number:1})},e=function(){socket.emit("button",{number:2})},f=function(){socket.emit("button",{number:3})},g=function(){socket.emit("button",{number:4})},h=function(){socket.emit("button",{number:5})},i=function(){socket.emit("button",{number:6})},j=function(){socket.emit("button",{number:7})},k=function(){socket.emit("button",{number:8})},l=function(){socket.emit("button",{number:9})},m=function(){socket.emit("button",{number:10})},n=function(){scale=1.1*scale,socket.emit("resize",{width:width/scale,height:height/scale})},o=function(){scale/=1.1,socket.emit("resize",{width:width/scale,height:height/scale})};Buttons(width/2-width/20,height/2-width/40,width/10,width/20,b,"startmobile",0),Buttons(width/2-width/20,height/2-width/10,width/10,width/20,c,"startreg",0),Buttons(7*width/8,0,width/8,width/8,d,"button1",1),Buttons(7*width/8,width/8,width/8,width/8,e,"button2",1),Buttons(7*width/8,2*width/8,width/8,width/8,f,"button3",1),Buttons(7*width/8,2*width/8,width/8,width/8,g,"button4",1),Buttons(7*width/8,2*width/8,width/8,width/8,h,"button5",1),Buttons(7*width/8,2*width/8,width/8,width/8,i,"button6",1),Buttons(7*width/8,2*width/8,width/8,width/8,n,"plus",2),Buttons(7*width/8,2*width/8,width/8,width/8,o,"minus",2),Buttons(7*width/8,2*width/8,width/8,width/8,j,"mode0",1),Buttons(7*width/8,2*width/8,width/8,width/8,k,"mode1",1),Buttons(7*width/8,2*width/8,width/8,width/8,l,"mode2",1),Buttons(7*width/8,2*width/8,width/8,width/8,m,"mode3",1);setbuttons(),socket.emit("resize",{width:width/scale,height:height/scale})}function main(){var a=function(){if(start){if(touchscreen){control.update(),count=0;var b=0,c={};if(len>0){for(var d={},e=0;e<len;e++)canX[e]<control.width&&canY[e]>control.y?(count=1,(canX[e]-control.width/2)/control.width>0?c.x=-1*Math.pow((canX[e]-control.width/2)/control.width,2)*5.2:c.x=1*Math.pow((canX[e]-control.width/2)/control.width,2)*5.2,c.x=-1*Math.pow((canX[e]-control.width/2)/control.width,3)*5.2,c.y=-1*Math.pow((canY[e]-height+control.width/2)/control.height,3)*5.2,c.inputId="control"):canX[e]<width-height/7&&(b++,d.x=(canX[e]+me.x-width/2)/scale,d.y=(canY[e]+me.y-height/2)/scale,d.inputId="shooting",d.state=!0);socket.emit("keypress",d)}else socket.emit("keypress",{inputId:"shooting",state:!1});0==b&&socket.emit("keypress",{inputId:"shooting",state:!1}),0==count&&(c.x=0,c.y=0,c.inputId="control"),socket.emit("keypress",c)}else if(mouseIsDown){for(var f={},e=0;e<canX.length;e++)canX[e]>0&&canY[e]>0&&(f.x=(canX[e]+me.x-width/2)/scale,f.y=(canY[e]+me.y-height/2)/scale,f.state=!0);f.inputId="shooting",socket.emit("keypress",f)}else socket.emit("keypress",{inputId:"shooting",state:!1});if(2==gstate&&mouseIsDown)for(var e=0;e<canX.length;e++)if(canX[e]>0&&canY[e]>0&&canX[e]<width-height/7){var f={};f.d=Math.sqrt(Math.pow((canX[e]-width/2)/scale,2)+Math.pow((canY[e]-height/2)/scale,2)),f.angle=Math.atan2(canY[e]-height/2,canX[e]-width/2)/TO_RADIANS-me.angle,socket.emit("place",f)}for(var g=0;g<canX.length;g++)for(var e=0;e<myships.length;e++)canY[g]>myships[e].y-myships[e].height/2&&canY[g]<myships[e].y+myships[e].height/2&&canX[g]>myships[e].x-myships[e].width/2&&canX[g]<myships[e].x+myships[e].width/2&&mouseIsDown&&(console.log("t"),socket.emit("select",myships[e].id))}else{ctx.fillStyle="blue",ctx.fillRect(0,0,width,height),ctx.fillStyle="white";for(var e in Buttons.list){var h=Buttons.list[e];0==h.gamestate&&h.update()}}go&&draw(idata),window.requestAnimationFrame(a,canvas)};window.requestAnimationFrame(a,canvas)}function MouseWheelHandler(a){a.preventDefault();var a=window.event||a,b=Math.min(.05,Math.max(-.05,(a.wheelDelta||-a.detail)/1e3));return b>0&&scale<10&&(scale*=b+1),b<0&&scale>.1&&(scale*=b+1),socket.emit("resize",{width:width/scale,height:height/scale}),!1}var touchscreen=!0,start=!1,keystate,canvas,ctx,canX=[],canY=[],mouseIsDown=0,len=0,tttouch=0,width,height,ctx,canvas,id,gstate,scale=1,selected=0,seltype=0,img=new Image;img.src="/client/img/sprites.png";var bimg=new Image;bimg.src="/client/img/buttons.png";var patern=new Image;patern.src="/client/img/patern.png";var count=0,deathcount=0,mapw=1e4,maph=1e4,mappw=400,mapph=400,go=!1,idata={},bsprite=[{x:376,y:192},{x:8,y:100},{x:8,y:8},{x:100,y:100},{x:8,y:192},{x:100,y:8},{x:100,y:8},{x:284,y:8},{x:8,y:8},{x:376,y:100},{x:192,y:8},{x:284,y:100},{x:192,y:192},{x:560,y:100},{x:468,y:100},{x:192,y:100},{x:376,y:8},{x:8,y:8},{x:468,y:8},{x:8,y:8}],myships=[],psprite=[{x:6,y:1558,x2:88,y2:1558,x3:170,y3:1558},{x:6,y:2312,x2:92,y2:2312}],csprite=[{x:6,y:1624,width:14,height:6},{x:6,y:2158,width:18,height:14},{x:6,y:2192,width:12,height:10},{x:6,y:2218,width:28,height:14,x2:68,y2:2218},{x:6,y:2252,width:12,height:10},{x:-2,y:2278,width:22,height:14}];console.log(csprite);var sprites=[{x1:6,y1:6,x2:108,y2:6,x3:210,y3:6},{x:6,y:96},{x:6,y:146},{x:6,y:220},{x:6,y:316},{x:6,y:382},{x:6,y:464},{x:6,y:562},{x:6,y:692},{x:6,y:766},{x:6,y:1040},{x:6,y:1188},{x:6,y:1346},{x:6,y:1460},{x:6,y:1642},{x:6,y:1732},{x:6,y:1822},{x:6,y:2020},{x:6,y:2378},{x:6,y:2524},{x:6,y:2634},{x:6,y:2736},{x:6,y:2838},{x:6,y:2940}],bulsprite=[{x:6,y:294},{x:6,y:2920}],coin={x:6,y:1170,width:6,height:6},me={},setbuttons=function(){control.update(),Buttons.list.startmobile.x=width/2-3.14*width/20,Buttons.list.startmobile.y=height/2-width/20,Buttons.list.startmobile.width=3.14*width/10,Buttons.list.startmobile.height=width/10,Buttons.list.startreg.x=width/2-3.14*width/20,Buttons.list.startreg.y=height/2-width/5,Buttons.list.startreg.width=3.14*width/10,Buttons.list.startreg.height=width/10,Buttons.list.button1.x=width-height/7,Buttons.list.button1.y=0,Buttons.list.button1.width=height/7,Buttons.list.button1.height=height/7,Buttons.list.button2.x=width-height/7,Buttons.list.button2.y=height/7,Buttons.list.button2.width=height/7,Buttons.list.button2.height=height/7,Buttons.list.button3.x=width-height/7,Buttons.list.button3.y=2*height/7,Buttons.list.button3.width=height/7,Buttons.list.button3.height=height/7,Buttons.list.button4.x=width-height/7,Buttons.list.button4.y=3*height/7,Buttons.list.button4.width=height/7,Buttons.list.button4.height=height/7,Buttons.list.button5.x=width-height/7,Buttons.list.button5.y=4*height/7,Buttons.list.button5.width=height/7,Buttons.list.button5.height=height/7,Buttons.list.button6.x=width-height/7,Buttons.list.button6.y=5*height/7,Buttons.list.button6.width=height/7,Buttons.list.button6.height=height/7,Buttons.list.plus.x=control.width,Buttons.list.plus.y=11*height/12,Buttons.list.plus.width=height/12,Buttons.list.plus.height=height/12,Buttons.list.minus.x=control.width+height/12,Buttons.list.minus.y=11*height/12,Buttons.list.minus.width=height/12,Buttons.list.minus.height=height/12,Buttons.list.mode0.x=width-5*height/7,Buttons.list.mode0.y=6*height/7,Buttons.list.mode0.width=height/7,Buttons.list.mode0.height=height/7,Buttons.list.mode1.x=width-4*height/7,Buttons.list.mode1.y=6*height/7,Buttons.list.mode1.width=height/7,Buttons.list.mode1.height=height/7,Buttons.list.mode2.x=width-3*height/7,Buttons.list.mode2.y=6*height/7,Buttons.list.mode2.width=height/7,Buttons.list.mode2.height=height/7,Buttons.list.mode3.x=width-2*height/7,Buttons.list.mode3.y=6*height/7,Buttons.list.mode3.width=height/7,Buttons.list.mode3.height=height/7},Buttons=function(a,b,c,d,e,f,g){var h={x:a,y:b,width:c,height:d,clickfunction:e,name:f,gamestate:g,pressed:!1,presses:0,update:function(){h.presses=0,"plus"!=h.name&&"minus"!=h.name||(ctx.fillStyle="white",ctx.fillRect(h.x,h.y,h.width,h.height)),"startreg"==h.name&&ctx.drawImage(bimg,8,560,264,84,h.x,h.y,h.width,h.height),"startmobile"==h.name&&ctx.drawImage(bimg,8,652,264,84,h.x,h.y,h.width,h.height),"button4"==h.name&&ctx.drawImage(bimg,376,192,84,84,h.x,h.y,h.width,h.height),"button5"==h.name&&ctx.drawImage(bimg,468,192,84,84,h.x,h.y,h.width,h.height),"button6"==h.name&&ctx.drawImage(bimg,284,192,84,84,h.x,h.y,h.width,h.height),5==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[12].x,bsprite[12].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),4==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[5].x,bsprite[5].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),7==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[16].x,bsprite[16].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[18].x,bsprite[18].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name&&ctx.drawImage(bimg,bsprite[4].x,bsprite[4].y,84,84,h.x,h.y,h.width,h.height)),6==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[7].x,bsprite[7].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[10].x,bsprite[10].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height)),2==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[6].x,bsprite[6].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height)),9==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[13].x,bsprite[13].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height)),14==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[13].x,bsprite[13].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[14].x,bsprite[14].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name),11==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[9].x,bsprite[9].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),15==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[11].x,bsprite[11].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),0==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[1].x,bsprite[1].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name&&ctx.drawImage(bimg,bsprite[2].x,bsprite[2].y,84,84,h.x,h.y,h.width,h.height),"button3"==h.name&&ctx.drawImage(bimg,bsprite[4].x,bsprite[4].y,84,84,h.x,h.y,h.width,h.height)),3==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[15].x,bsprite[15].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),1==seltype&&("button1"==h.name&&ctx.drawImage(bimg,bsprite[3].x,bsprite[3].y,84,84,h.x,h.y,h.width,h.height),"button2"==h.name,"button3"==h.name),"mode0"!=h.name&&"mode1"!=h.name&&"mode2"!=h.name&&"mode3"!=h.name||ctx.fillRect(h.x,h.y,h.width,h.height);for(var a=0;a<len;a++)canY[a]>h.y&&canY[a]<h.y+h.height&&canX[a]>h.x&&canX[a]<h.x+h.width&&mouseIsDown&&(h.presses++,h.pressed||(console.log(h.pressed),"button1"!=h.name&&"button2"!=h.name&&"button3"!=h.name&&"button4"!=h.name&&"button5"!=h.name&&"button6"!=h.name||ctx.drawImage(bimg,652,8,84,84,h.x,h.y,h.width,h.height),"startreg"!=h.name&&"startmobile"!=h.name||ctx.drawImage(bimg,284,560,264,84,h.x,h.y,h.width,h.height),h.clickfunction()));0==h.presses?h.pressed=!1:h.pressed=!0}};return Buttons.list[h.name]=h,h};Buttons.list={};var control={width:width/3,height:width/3,x:0,y:height-width/3,draw:function(){ctx.fillRect(this.x,this.y,this.width,this.height)},update:function(){this.width=width/3,this.height=width/3,this.y=height-width/3}},TO_RADIANS=Math.PI/180,socket=io();socket.on("id",function(a){id=a,selected=id,console.log(id)}),socket.on("dead",function(a){a&&(location.reload(),console.log("test"))}),socket.on("newPoisitions",function(a){idata=a,go=!0});var draw=function(a){if(myships=[],start){ctx.fillStyle="white",ctx.fillStyle="#33B2FF";for(var b=0;b<a.ship.length;b++){ctx.fillStyle="black";var c=width/2,d=height/2;if(a.ship[b].playerid==id&&1==a.ship[b].leader&&(myships.push({id:a.ship[b].id,x:c,y:d,width:a.ship[b].width,height:a.ship[b].height}),me.x=a.ship[b].x*scale,me.y=a.ship[b].y*scale,me.width=a.ship[b].width,me.height=a.ship[b].height,me.angle=a.ship[b].angle,me.money=a.ship[b].money,me.maxhealth=a.ship[b].maxhealth,me.health=a.ship[b].health,me.color=a.ship[b].color,seltype=a.ship[b].seltype,gstate=a.ship[b].gstate,!a.ship[b].death)){for(var e=Math.ceil(width/(mappw*scale))+1,f=Math.ceil(height/(mapph*scale))+1,g=-(me.x/(mappw*scale)-Math.floor(me.x/(mappw*scale)))*mappw*scale+width/2-Math.floor(e/2)*mappw*scale,h=-(me.y/(mapph*scale)-Math.floor(me.y/(mapph*scale)))*mapph*scale+height/2-Math.floor(f/2)*mapph*scale,i=0;i<e+1;i++)for(var j=0;j<f+1;j++)ctx.drawImage(patern,0,0,400,400,g+i*mappw*scale,h+j*mapph*scale,mappw*scale,mapph*scale);me.x-width/2-width/2<0&&(ctx.fillStyle="yellow",ctx.fillRect(0-me.x+width/2-width/2,0,width/2,height)),me.y-height/2-height/2<0&&(ctx.fillStyle="yellow",ctx.fillRect(0,0-me.y+height/2-height/2,width,height/2)),me.x+width/2>mapw*scale&&(ctx.fillStyle="yellow",ctx.fillRect(mapw*scale-me.x+width/2,0,width/2,height)),me.x+width/2>mapw*scale&&(ctx.fillStyle="yellow",ctx.fillRect(mapw*scale-me.x+width/2,0,width/2,height)),me.y+height/2>maph*scale&&(ctx.fillStyle="yellow",ctx.fillRect(0,maph*scale-me.y+height/2,width,height/2));for(var k=0;k<a.wake.length;k++)ctx.fillStyle="white",ctx.globalAlpha=1-a.wake[k].time/50,a.wake[k].x*scale-me.x+width/2>0&&a.wake[k].x*scale-me.x+width/2<width&&a.wake[k].y*scale-me.y+height/2>0&&a.wake[k].y*scale-me.y+height/2<height&&ctx.fillRect(a.wake[k].x*scale-me.x+width/2,a.wake[k].y*scale-me.y+height/2,5*scale,5*scale);ctx.globalAlpha=1,ctx.fillStyle="black",ctx.fillRect(width-height/7,6*height/7,height/7,height/7),ctx.font="14px Georiga",ctx.fillText(me.money,30,30),0==a.ship[b].type&&(1==a.ship[b].frame&&drawRotatedImage(width/2,height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x1,sprites[0].y1),2==a.ship[b].frame&&drawRotatedImage(width/2,height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x2,sprites[0].y2),3==a.ship[b].frame&&drawRotatedImage(width/2,height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x3,sprites[0].y3)),a.ship[b].type>0&&drawRotatedImage(width/2,height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[a.ship[b].type].x,sprites[a.ship[b].type].y);for(var l=0;l<a.ship[b].cannons.length;l++){var m=a.ship[b].cannons[l].type;drawRotatedImage(a.ship[b].cannons[l].x*scale-me.x+width/2,a.ship[b].cannons[l].y*scale-me.y+height/2,csprite[m].width,csprite[m].height,a.ship[b].cannons[l].angle,csprite[m].x,csprite[m].y)}if(void 0!=a.ship[b].planes)for(var l=0;l<a.ship[b].planes.length;l++){var m=a.ship[b].planes[l].type;1==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2)),0==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2),3==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x3,psprite[m].y3)),ctx.fillStyle="white",ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].maxhealth*scale/100*width/14,width*scale/100),ctx.fillStyle=a.ship[b].color,ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].health*scale/100*width/14,width*scale/100)}}}for(var b=0;b<a.ship.length;b++){if(a.ship[b].playerid!==id){0==a.ship[b].type&&(1==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x1,sprites[0].y1),2==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x2,sprites[0].y2),3==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x3,sprites[0].y3)),a.ship[b].type>0&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[a.ship[b].type].x,sprites[a.ship[b].type].y);var n=a.ship[b].name.substring(0,30);if(ctx.font=14*scale+"px Georgia",ctx.fillStyle="white",ctx.fillText(n,a.ship[b].x*scale-me.x+width/2-ctx.measureText(n).width/2,a.ship[b].y*scale-me.y+height/2-(a.ship[b].width/2+14+width/40)*scale),ctx.fillRect(a.ship[b].x*scale-me.x+width/2-a.ship[b].maxhealth*scale/100*width/28,a.ship[b].y*scale-me.y+height/2-a.ship[b].width/2*scale-width/30*scale,a.ship[b].maxhealth*scale/100*width/14,width*scale/100),ctx.fillStyle=a.ship[b].color,ctx.fillRect(a.ship[b].x*scale-me.x+width/2-a.ship[b].maxhealth*scale/100*width/28,a.ship[b].y*scale-me.y+height/2-a.ship[b].width/2*scale-width/30*scale,a.ship[b].health*scale/100*width/14,width*scale/100),void 0!=a.ship[b].planes)for(var l=0;l<a.ship[b].planes.length;l++){var m=a.ship[b].planes[l].type;1==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2)),0==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2),3==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x3,psprite[m].y3)),ctx.fillStyle="white",ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].maxhealth*scale/100*width/14,width*scale/100),ctx.fillStyle=a.ship[b].color,ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].health*scale/100*width/14,width*scale/100)}for(var l=0;l<a.ship[b].cannons.length;l++){var m=a.ship[b].cannons[l].type;drawRotatedImage(a.ship[b].cannons[l].x*scale-me.x+width/2,a.ship[b].cannons[l].y*scale-me.y+height/2,csprite[m].width,csprite[m].height,a.ship[b].cannons[l].angle,csprite[m].x,csprite[m].y)}}if(a.ship[b].playerid==id&&0==a.ship[b].leader){var c=a.ship[b].x*scale-me.x+width/2,d=a.ship[b].y*scale-me.y+height/2;if(a.ship[b].playerid==id&&myships.push({id:a.ship[b].id,x:c,y:d,width:a.ship[b].width,height:a.ship[b].height}),0==a.ship[b].type&&(1==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x1,sprites[0].y1),2==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x2,sprites[0].y2),3==a.ship[b].frame&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[0].x3,sprites[0].y3)),a.ship[b].type>0&&drawRotatedImage(a.ship[b].x*scale-me.x+width/2,a.ship[b].y*scale-me.y+height/2,a.ship[b].width,a.ship[b].height,a.ship[b].angle*TO_RADIANS,sprites[a.ship[b].type].x,sprites[a.ship[b].type].y),ctx.fillStyle="white",ctx.fillRect(a.ship[b].x*scale-me.x+width/2-a.ship[b].maxhealth*scale/100*width/28,a.ship[b].y*scale-me.y+height/2-a.ship[b].width/2*scale-width/30*scale,a.ship[b].maxhealth*scale/100*width/14,width*scale/100),ctx.fillStyle=a.ship[b].color,ctx.fillRect(a.ship[b].x*scale-me.x+width/2-a.ship[b].maxhealth*scale/100*width/28,a.ship[b].y*scale-me.y+height/2-a.ship[b].width/2*scale-width/30*scale,a.ship[b].health*scale/100*width/14,width*scale/100),void 0!=a.ship[b].planes)for(var l=0;l<a.ship[b].planes.length;l++){var m=a.ship[b].planes[l].type;1==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2)),0==a.ship[b].planes[l].type&&(1==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x,psprite[m].y),2==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x2,psprite[m].y2),3==a.ship[b].planes[l].frame&&drawRotatedImage(a.ship[b].planes[l].x*scale-me.x+width/2,a.ship[b].planes[l].y*scale-me.y+height/2,a.ship[b].planes[l].width,a.ship[b].planes[l].height,a.ship[b].planes[l].angle*TO_RADIANS,psprite[m].x3,psprite[m].y3)),ctx.fillStyle="white",ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].maxhealth*scale/100*width/14,width*scale/100),ctx.fillStyle=a.ship[b].color,ctx.fillRect(a.ship[b].planes[l].x*scale-me.x+width/2-a.ship[b].planes[l].maxhealth*scale/100*width/28,a.ship[b].planes[l].y*scale-me.y+height/2-a.ship[b].planes[l].width/2*scale-width/30*scale,a.ship[b].planes[l].health*scale/100*width/14,width*scale/100)}for(var l=0;l<a.ship[b].cannons.length;l++){var m=a.ship[b].cannons[l].type;drawRotatedImage(a.ship[b].cannons[l].x*scale-me.x+width/2,a.ship[b].cannons[l].y*scale-me.y+height/2,csprite[m].width,csprite[m].height,a.ship[b].cannons[l].angle,csprite[m].x,csprite[m].y)}}a.ship[b].playerid==id?(ctx.fillStyle="red",ctx.fillRect(height/7*a.ship[b].x/mapw+width-height/7,height/7*a.ship[b].y/maph+6*height/7,2,2)):(ctx.fillStyle="white",ctx.fillRect(height/7*a.ship[b].x/mapw+width-height/7,height/7*a.ship[b].y/maph+6*height/7,2,2))}for(var b=0;b<a.bullet.length;b++)ctx.fillStyle="black",drawRotatedImage(a.bullet[b].x*scale-me.x+width/2,a.bullet[b].y*scale-me.y+height/2,a.bullet[b].width,a.bullet[b].height,a.bullet[b].angle,bulsprite[a.bullet[b].type].x,bulsprite[a.bullet[b].type].y);for(var b=0;b<a.coin.length;b++)a.coin[b].x*scale-me.x+width/2>0&&a.coin[b].x*scale-me.x+width/2<width&&a.coin[b].y*scale-me.y+height/2>0&&a.coin[b].y*scale-me.y+height/2<height&&(ctx.fillStyle="black",ctx.drawImage(img,coin.x,coin.y,12,12,a.coin[b].x*scale-me.x+width/2,a.coin[b].y*scale-me.y+height/2,coin.width*scale,coin.height*scale));for(var b=0;b<a.ship.length;b++);ctx.fillRect(width/2-me.maxhealth/100*width/14/2,0,me.maxhealth/100*width/14,width/100),ctx.fillStyle=me.color,ctx.fillRect(width/2-me.health/100*width/14/2,0,me.health/100*width/14,width/100),ctx.fillStyle="white";for(var b in Buttons.list){var o=Buttons.list[b];1==o.gamestate&&1==gstate&&o.update(),touchscreen&&2==o.gamestate&&o.update()}touchscreen&&control.draw()}};window.onresize=function(){width=window.innerWidth,height=window.innerHeight,canvas.width=width,canvas.height=height,socket.emit("resize",{width:width/scale,height:height/scale}),setbuttons()},window.onload=main(),document.addEventListener?(document.addEventListener("mousewheel",MouseWheelHandler,!1),document.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):document.attachEvent("onmousewheel",MouseWheelHandler),document.onkeydown=function(a){68==a.keyCode&&socket.emit("keypress",{inputId:"right",state:!0}),83==a.keyCode&&socket.emit("keypress",{inputId:"down",state:!0}),65==a.keyCode&&socket.emit("keypress",{inputId:"left",state:!0}),87==a.keyCode&&socket.emit("keypress",{inputId:"up",state:!0})},document.onkeyup=function(a){68==a.keyCode&&socket.emit("keypress",{inputId:"right",state:!1}),83==a.keyCode&&socket.emit("keypress",{inputId:"down",state:!1}),65==a.keyCode&&socket.emit("keypress",{inputId:"left",state:!1}),87==a.keyCode&&socket.emit("keypress",{inputId:"up",state:!1})},init();
    </script>
</body>

</html>
